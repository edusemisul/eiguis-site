<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Painel — EÍGUIS</title>
  <link rel="icon" href="/favicon.ico">
  <link href="https://unpkg.com/@fontsource/inter@5.0.8/variable.css" rel="stylesheet">
  <style>
    :root{color-scheme:dark light}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:"InterVariable",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;background:#0a0f1c;color:#e5e7eb}
    header{display:flex;align-items:center;justify-content:space-between;padding:18px 22px;border-bottom:1px solid rgba(148,163,184,.16);background:#0c1324}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:30px;height:30px;border-radius:8px;background:#facc15;color:#111;display:grid;place-items:center;font-weight:900}
    .wrap{max-width:1000px;margin:0 auto;padding:24px}
    h2{margin:8px 0 16px}
    .card{background:#0c1324;border:1px solid rgba(148,163,184,.16);border-radius:14px;padding:16px;margin-bottom:16px}
    input{width:100%;background:#0b1222;border:1px solid #1f2a44;border-radius:10px;padding:12px 12px;color:#e5e7eb;font-size:14px;outline:none;transition:.2s}
    input:focus{border-color:#60a5fa;box-shadow:0 0 0 3px rgba(96,165,250,.15)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btn{border:0;border-radius:10px;padding:12px 14px;font-weight:700;font-size:14px;background:linear-gradient(180deg,#93c5fd 0%,#3b82f6 100%);color:#0b1020;cursor:pointer}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:10px;border-bottom:1px solid rgba(148,163,184,.14);text-align:left}
    .muted{color:#93a2b6;font-size:13px}
    .danger{background:linear-gradient(180deg,#fda4af 0%,#ef4444 100%);color:#160a0a}
    .err{color:#fda4af;font-size:13px;margin-top:10px}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">Ei</div>
      <div>
        <div style="font-weight:800">EÍGUIS • Painel</div>
        <div id="who" class="muted"></div>
      </div>
    </div>
    <div>
      <button id="logout" class="btn danger">Sair</button>
    </div>
  </header>

  <div class="wrap">
    <div class="card">
      <h2>Novo Caso</h2>
      <div class="row">
        <div>
          <label class="muted">Título</label>
          <input id="titulo" placeholder="Ex.: RO 12345/2025 – Furto qualificado" />
        </div>
        <div>
          <label class="muted">Descrição</label>
          <input id="descricao" placeholder="Breve resumo (opcional)" />
        </div>
      </div>
      <div style="margin-top:12px;display:flex;gap:10px">
        <button id="criar" class="btn">Criar caso</button>
        <div id="err" class="err" style="display:none"></div>
      </div>
    </div>

    <div class="card">
      <h2>Meus Casos</h2>
      <div class="muted" id="noRows" style="display:none">Nenhum caso ainda.</div>
      <div style="overflow:auto">
        <table id="tbl" style="display:none">
          <thead>
            <tr><th>ID</th><th>Título</th><th>Descrição</th><th>Criado em</th></tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script type="module">
    // ====== JÁ CONFIGURADO PARA O SEU PROJETO ======
    const SUPABASE_URL = 'https://bsdleapswwzyeeknsxyj.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJzZGxlYXBzd3d6eWVla25zeHlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5NDcwNzAsImV4cCI6MjA3NzUyMzA3MH0.wlnWWRLuBPGs7F9na-IyDozuXz_L4MmtnT7JHVjXFXo';
    // ================================================

    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: true }
    });

    // Garante sessão
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) { location.href = '/login.html'; }

    // Mostra quem é
    const { data: { user } } = await supabase.auth.getUser();
    document.getElementById('who').textContent = user?.email || 'Usuário';

    // Logout
    document.getElementById('logout').addEventListener('click', async () => {
      await supabase.auth.signOut();
      location.href = '/login.html';
    });

    const $ = id => document.getElementById(id);
    const tbody = $('tbody'), tbl = $('tbl'), noRows = $('noRows'), err = $('err');

    async function loadCases() {
      err.style.display = 'none';
      const { data, error } = await supabase
        .from('cases')
        .select('id,title,description,created_at')
        .order('created_at', { ascending: false });

      if (error) { err.textContent = error.message; err.style.display = 'block'; return; }

      tbody.innerHTML = '';
      if (!data || data.length === 0) {
        tbl.style.display = 'none'; noRows.style.display = 'block'; return;
      }
      noRows.style.display = 'none'; tbl.style.display = 'table';
      for (const row of data) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td style="font-family:ui-monospace,Menlo,Consolas">${row.id}</td>
          <td>${row.title || '-'}</td>
          <td>${row.description || '-'}</td>
          <td>${new Date(row.created_at).toLocaleString('pt-BR')}</td>`;
        tbody.appendChild(tr);
      }
    }

    $('criar').addEventListener('click', async () => {
      err.style.display = 'none';
      const title = $('titulo').value.trim();
      const description = $('descricao').value.trim();
      if (!title) { err.textContent = 'Informe um título.'; err.style.display = 'block'; return; }
      const { error } = await supabase.from('cases').insert({ title, description });
      if (error) { err.textContent = error.message; err.style.display = 'block'; return; }
      $('titulo').value = ''; $('descricao').value = '';
      await loadCases();
    });

    await loadCases();
  </script>
</body>
</html>
